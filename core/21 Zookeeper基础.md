## Zookeeper

#### 1	什么是ZooKeeper

分布式协调工具，（注册中心，分布式配置中心，消息中间件，分布式事务，分布式锁，可实现选举策略（哨兵机制），

本地动态负载均衡（区别Nginx服务器端负载均衡），消息中间件集群管理）

#### 2	ZooKeeper存储结构与特性

层次化的目录结构，类似Xml的node节点，每个节点有唯一的标识路径。

#### 3	ZooKeeper中临时节点与持久节点区别

**临时节点**：客户端断开（会话结束），节点删除。

**持久节点**：节点会持久化在硬盘上。（分布式锁使用的就是临时节点的特性实现）。

每个节点的删除和修改都会有事件通知。

#### 4	ZooKeeper应用场景

1）数据发布与订阅（配置中心）

2）负载均衡

3）命名服务

4）分布式通知/协调

5）集群管理和Master选举

6）分布式锁

7）分布式事务

#### 5	Dubbo本地动态负载均衡原理

使用Zookeeper服务注册和发现，然后采用轮训算法。

#### 6	什么场景下会导致ZooKeeper发生延迟通知

服务器宕机的情况下，会产生延迟通知。

#### 7	分布式锁有那些实现方案

1）使用数据库实现分布式锁

缺点:性能差、线程出现异常时，容易出现死锁

2）使用Redis实现分布式锁 通过setNx

缺点:锁的失效时间难控制、容易产生死锁、非阻塞式、不可重入

3）使用Zookeeper实现分布式锁

实现相对简单、可靠性强、使用临时节点，失效时间容易控制

#### 8	ZooKeeper实现分布式锁的原理

​		使用Zookeeper创建临时节点来实现分布式锁，多个请求来创建临时节点，如果节点存在则等待，执行完毕后锁节点

消失，通过watch来监控节点的变化，一旦临时节点消失，其余请求竞争，获取资源创建锁节点。

以此类推，多个JVM在Zookeeper创建同一个临时类型的锁节点，如果多个客户端创建相同的lock节点，最终只有一个

JVM获取资源并创建lock节点，其余JVM等待，如果程序执行结束，关闭当前zk连接，则临时节点消失，其余JVM使用事

件通知，获取Lock节点删除信息，开始竞争获取锁，以此类推。

#### 9	ZooKeeper实现分布式锁与Redis实现分布式锁区别

1) 使用Redis实现分布式锁 通过setNx

缺点:锁的失效时间难控制、容易产生死锁、非阻塞式、不可重入

2) 使用Zookeeper实现分布式锁

实现相对简单、可靠性强、使用临时节点，失效时间容易控制

#### 10	使用Zookeeper实现服务Master选举原理

使用临时节点还有节点的监控实现选举。

多个服务启动的时候，在Zookeeper创建相同的临时节点，谁成功创建临时节点，就是主服务器。

当主服务器宕机后，主服务器和Zookeeper的会话连接就会断开，其余的从服务器开始竞争。

#### 11	ZooKeeper集群选举原理

选举机制，领导者 跟随者 只能保证一个领导者

恢复模式：领导者宕机后，在跟随者中间，采用半数通过机制，选举一个新的领导者。

#### 12	分布式Session一致性解决方案有那些

1）Cookie代替session。

2）使用nginx反向代理 ip-hash 同一个ip访问只能访问同一个服务器。

3）使用数据库，效率差。

4）tomcat内置session同步，有延迟，不推荐。

5）使用spring-session 将session保存到Redis中。

6）使用token代替session功能。

#### 13	网站跨域问题有遇到过吗

两个项目之间通过ajax实现通讯，如果浏览器访问的域名地址与ajax访问的地址不一致的情况下，默认情况下浏览器会有

安全机制，这个机制跨域问题，会无法获取返回结果。

#### 14	网站跨域你是如何解决的

1）使用jsonp解决网站跨域 （不支持post请求，仅支持get请求。）

2）使用HttpClient内部转发（不推荐，两次转发，效率非常低）

3）使用设置响应头允许跨域（推荐）

4）基于Nginx搭建企业级API接口网关（强烈推荐）可以保证域名和端口都一致，内部实现转发

5）使用Zuul搭建微服务API接口网关（强烈推荐）